#!/usr/bin/env node

var path = require("path");
var parseArgs = require("minimist");
var pipeline = require("../lib/pipeline");

var args = require("minimist")(process.argv.slice(2), {
    "boolean": ["v", "verbose", "c", "clean"],
    "string": ["filter"]
});

var cwd = process.cwd();
var sourceDir = cwd;

if (args._.length >= 1) {
    sourceDir = path.resolve(cwd, args._[0]);
}

var targetDir = sourceDir;

if (args._.length >= 2) {
    targetDir = path.resolve(cwd, args._[1]);
}

var verbose = args.v || args.verbose || false;
var filter = args.f || args.filter || null;
var clean = args.c || args.clean || false;

console.log("s: " + sourceDir + ", t: " + targetDir);

if (clean) {
    pipeline.clean(sourceDir);
} else {
    pipeline.processDirectory(
        sourceDir,
        targetDir, 
        {
            logger: verbose ? console.log : null,
            filter: filter
        });
}

